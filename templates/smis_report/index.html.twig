{% extends 'base.html.twig' %}

{% block subTitle %}
	<li class="active">{% trans %}
		SMIS{% endtrans %}</li>
	<li class="active">
		<a href="{{path('smis_report')}}">{% trans %}
			<strong>
				SMIS Report{% endtrans %}
			</strong>
		</a>
	</li>
{% endblock %}
{% block body %}
	<div class="row">
		<div class="col-md-12 col-sm-12 widget-container-col" id="widget-container-col-8">
			<div class="widget-box widget-color-blue" id="widget-box-8">
				<div class="widget-header">
					<h5 class="widget-title bigger lighter">
						<strong>SMIS Report
						</strong>
					</h5>
					<div class="widget-toolbar">
						<span class="badge badge-info">
							{% trans %}Total{% endtrans %}
							:
							{# <strong>{{principal_offices.getTotalItemCount()}}</strong> #}

						</span>
					</div>
				</div>
				<div class="widget-body">
					<div class="widget-toolbox" id="widget-toolbox-1"></div>
					<div class="widget-main padding-16">
						<div class="row">
							<div class="search-area well col-md-12">

								<div class="row">
									{{ form_start(form) }}
									<div class="form-group col-md-4" style="display:inline;">
										{{ form_label(form.planningYear," Year ") }}
										{{ form_widget(form.planningYear,{'attr':{ 'class': ' select2 form-control','required':'true'}}) }}


									</div>
									<div class="form-group col-md-4" style="display:inline;">
										{{ form_label(form.planningQuarter," Quarter  ") }}
										{{ form_widget(form.planningQuarter,{'attr':{ 'class': ' select2 form-control','required':'true'}}) }}


									</div>

									<div class="form-group col-md-4" style="display:inline;">
										{{ form_label(form.principalOffice," Principal Office ") }}
										{{ form_widget(form.principalOffice,{'attr':{ 'class': ' select2 form-control','required':'true'}}) }}


									</div>

									<button type="submit" class="btn btn-sm btn-primary" style="display:inline;margin-top:25px;margin-left:0px;">{% trans %}filter{% endtrans %}</button>
									{{ form_end(form) }}


								</div>
							</div>
						</div>
						<div class="table-responsive">
							{% if custom == 1 %}

								Total Accomplishment of
								{{ principalOffice }}
								=
								{% if average > 100  %}
									<b class="badge badge-primary">

										{{ average | number_format(2, '.',',') }}%
									</b>
								{% elseif average <= 100  and average >= 75 %}
									<b class="badge badge-success">

										{{ average | number_format(2, '.',',') }}%</b>
								{% elseif average <= 74  and average >= 50 %}

									<b class="badge badge-warning">

										{{ average | number_format(2, '.',',') }}%</b>
								{% else %}
									<b class="badge badge-danger">

										{{ average | number_format(2, '.',',') }}%</b>
								{% endif %}
							{% endif %}


							<table class="table table-striped table-bordered table-hover">

								<thead>

									<tr>
										<th>#</th>

										<th>Principal Office</th>
										<th>Initiative
										</th>
										<th>Year</th>
										<th>Quarter</th>
										<th>Plan</th>
										<th>Accomplishment</th>
										<th>Percent</th>
										<th>Operational Office Detail</th>

									</tr>
								</thead>


								<tbody>
									{% set count =  principal_reports.getItemNumberPerPage() * (principal_reports.getCurrentPageNumber() -1) %}
									{% for principal_report in principal_reports %}
										{% set percent = 0 %}
										<tr>
											{% set count = count + 1 %}
											<td>{{ count }}</td>
											<td>{{ principal_report.suitableInitiative.principalOffice }}</td>
											<td>{{ principal_report.suitableInitiative.initiative }}</td>

											<td>{{ principal_report.suitableInitiative. planningyear }}</td>

											<td>{{ principal_report.quarter }}</td>

											<td>{{ principal_report.planValue }}</td>

											<td>{{ principal_report.accompValue }}</td>
											{% set percent = (principal_report.accompValue * 100) / principal_report.planValue %}
											{% if percent > 100  %}
												<td class="badge badge-primary">

													{{ percent | number_format(2, '.',',') }}
												</td>
											{% elseif percent <= 100  and percent >= 75 %}
												<td class="badge badge-success">

													{{ percent | number_format(2, '.',',') }}</td>
											{% elseif percent <= 74  and percent >= 50 %}

												<td class="badge badge-warning">

													{{ percent | number_format(2, '.',',') }}</td>
											{% else %}
												<td class="badge badge-danger">

													{{ percent | number_format(2, '.',',') }}</td>
											{% endif %}


											<td class="center">
												<div class="action-buttons">
													<a href="#" class="green bigger-140 show-details-btn" title="Show Details">
														<i class="ace-icon fa fa-angle-double-down"></i>
														<span class="sr-only">Operational Office Detail</span>
													</a>
												</div>
											</td>
										</tr>
										<tr class="detail-row">
											<td colspan="8">
												<div class="table-detail">
													<table class="table table-striped table-bordered table-hover">

														<thead>
															<tr>
																<th>Operational Office</th>
																<th>Plan</th>

																<th>Accomplishment</th>
																<th>percent</th>


															</tr>
														</thead>


														<tbody>

															{% for operational_Report in operational_Reports %}
																{% set percent2 = 0 %}
																<tr>
																	{% if principal_report.suitableInitiative.principalOffice == operational_Report.operationalOffice.principalOffice %}
																		{% if principal_report.id == operational_Report.planningAcomplishment.id %}


																			<td>{{ operational_Report.operationalOffice }}</td>
																			<td>{{ principal_report.planValue }}</td>
																			<td>{{ operational_Report.accomplishedValue }}</td>

																			{% set percent2 = (operational_Report.accomplishedValue * 100) / principal_report.planValue %}

																			{% if percent2 > 100  %}
																				<td class="badge badge-primary">

																					{{ percent2 | number_format(2, '.',',') }}
																				</td>
																			{% elseif percent2 <= 100  and percent2 >= 75 %}
																				<td class="badge badge-success">

																					{{ percent2 | number_format(2, '.',',') }}</td>
																			{% elseif percent2 <= 74  and percent2 >= 50 %}

																				<td class="badge badge-warning">

																					{{ percent2 | number_format(2, '.',',') }}</td>
																			{% else %}
																				<td class="badge badge-danger">

																					{{ percent2 | number_format(2, '.',',') }}</td>
																			{% endif %}
																		{% endif %}
																	{% endif %}
																</tr>
															{% endfor %}
														</tbody>
													</table>


												</div>
											</td>
										</tr>

									{% else %}
										<tr>
											<td colspan="6">no records found</td>
										</tr>
									{% endfor %}

								</tbody>
							</table>
							<div class="pull-right" style="margin-right:10px;" id="custompaginator">{{ knp_pagination_render(principal_reports) }}</div>

						</div>

					</div>
				</div>

			</div>
		</div>
	</div>
{% endblock %}
{% block javascripts %}
	<script type="text/javascript">
		$('.show-details-btn').on('click', function (e) {
e.preventDefault();
$(this).closest('tr').next().toggleClass('open');
$(this).find(ace.vars['.icon']).toggleClass('fa-angle-double-down').toggleClass('fa-angle-double-up');
});
	</script>
	<script>
		$('.show').click(function () {
$('#reject').modal('show');

var id = $(this).attr('data-performerTask');
$('.taskUserId').val(id);
})
	</script>
	<script>
		$('.accept').clicck(function () {
location.reload(true);

})
	</script>
{% endblock %}
