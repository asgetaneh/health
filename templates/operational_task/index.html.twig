{% extends 'base.html.twig' %}
{% block application_simple_title %}
	<strong>
		{% trans %}Strategic Management Information System{% endtrans %}</strong>
{% endblock %}
{% block mainTitle %}
	<li>
		<i class="icon-home home-icon"></i>
		<a href="">{% trans %}MIS{% endtrans %}</a>

		<span class="divider">
			<i class="arrow-icon"></i>
		</span>
	</li>
	<li>
		<i class="icon-home home-icon"></i>
		<a href="">{% trans %}SMIS{% endtrans %}</a>

		<span class="divider">
			<i class="arrow-icon"></i>
		</span>
	</li>

{% endblock %}
{% block subTitle %}
	<li class="active">{% trans %}Principal Office{% endtrans %}</li>
{% endblock %}
{% block body %}

	<div class="row">
		<div class="col-md-12 col-sm-12 widget-container-col" id="widget-container-col-8">
			<div class="widget-box widget-color-blue" id="widget-box-8">
				<div class="widget-header">
					<h5 class="widget-title bigger lighter">Principal Office
																																																																																																																																																																														                     TotalWeight=<div class="badge badge-danger">{{count}}</div>
					</h5>

					<div class="widget-toolbar"></div>

					<div class="widget-toolbar">
						<span class="badge badge-info">
							{% trans %}Total{% endtrans %}
							:
							{# <strong>{{tasks|length}}</strong> #}
						</span>
					</div>
				</div>

				<div class="widget-body">
					<div class="widget-toolbox" id="widget-toolbox-1">
						<div class="btn-toolbar">
							<div
								class="btn-group">
								{# {% if is_granted('CREATE_PERSPECTIVE') %} #}

								{% if count < 100 %}

									<a class="btn btn-primary btn-sm btn-white btn-round" data-toggle="modal" data-target="#myModal">
										<i class="ace-icon fa fa-plus bigger-110 blue"></i>
										{% trans %}
										Create{% endtrans %}</a>
								{% endif %}

								{% if count >= 100 %}

									<a class="btn btn-primary btn-sm btn-white btn-round" data-toggle="modal" data-target="#assign">
										<i class="ace-icon fa fa-check bigger-110 blue"></i>
										{% trans %}
										Assign{% endtrans %}</a>
								{% endif %}


							</div>


						</div>
					</div>

					<div class="widget-main padding-16">

						<div class="table-responsive">
							<form class="form-inline" method="post" style="display:inline;">

								<div class="input-group">
									<input type="text" class="form-control" name="search" placeholder="search"/>
									<div class="input-group-btn">
										<button type="submit" class="btn btn-default no-border btn-sm">
											<i class="ace-icon fa fa-search icon-on-right bigger-110"></i>
										</button>
									</div>
								</div>
							</form>
							{% if operational_tasks %}


								<table class="table table-striped table-bordered table-hover" style="margin-top:10px;">
									<thead>
										<tr>
											<th>#</th>
											<th>TaskName</th>
											<th>Description</th>
											<th>StartDate</th>
											<th>EndDate</th>
											<th>TimeGap</th>
											<th>Weight</th>
											<th>actions</th>
										</tr>
									</thead>
									<tbody>
										{% set count = 0 %}
										{% for operational_task in operational_tasks %}
											<tr>
												{% set count = count + 1 %}
												<td>{{ count}}</td>
												<td>{{ operational_task.taskName }}</td>
												<input type="hidden" class="task" value="{{operational_task.plan.id}}">
												<input type="hidden" class="office" value="{{operational_task.plan.office.id}}">

												<input type="hidden" class="userprincipal" value="{{app.user.id}}">
												<td>{{ operational_task.description }}</td>
												<td>{{ operational_task.startDate  }}</td>
												<td>{{ operational_task.endDate }}</td>
												<td>{{ operational_task.timeGap }}</td>
												<td>{{ operational_task.weight }}</td>

												<td>
													<a href="{{ path('operational_task_show', {'id': operational_task.id}) }}" class="btn btn-primary btn-sm">
														<i class="fa fa-eye"></i>
													</a>


													{# <a href="{{ path('operational_task_edit', {'id': operational_task.id}) }}" class="btn btn-warning btn-sm">
														Create</a> #}
												</td>


											</tr>
										{% else %}
											<tr>
												<td colspan="8">no records found</td>
											</tr>
										{% endfor %}
									</tbody>
								</table>
							{% endif %}

						</div>
					</div>
				</div>
			</div>
		</div>
		<div id="myModal" class="modal fade" role="dialog">
			<div
				class="modal-dialog">

				<!-- Modal content-->
				<div class="modal-content">
					<div class="modal-header bg-info">
						<button type="button" class="close" data-dismiss="modal">&times;</button>
						<h4 class="modal-title">Create Task</h4>
					</div>
					<div class="modal-body">
						{{ form_start(form,{'attr': {'class': 'my-form-class'} }) }}
						<div class="form-group">
							{{ form_label(form.taskName) }}
							{{ form_widget(form.taskName,{'attr':{ 'class': 'form-control'}}) }}

						</div>
						<div class="form-group">
							{{ form_label(form.description) }}
							{{ form_widget(form.description,{'attr':{ 'class': 'form-control'}}) }}

						</div>


						<div class="form-group">
							{{ form_label(form.weight) }}
							{{ form_widget(form.weight,{'attr':{ 'class': 'form-control'}}) }}

						</div>
                        	<div class="form-group">
							{{ form_label(form.startDate) }}
							{{ form_widget(form.startDate,{'attr':{ 'class': 'form-control'}}) }}

						</div>
                        	<div class="form-group">
							{{ form_label(form.endDate) }}
							{{ form_widget(form.endDate,{'attr':{ 'class': 'form-control'}}) }}

						</div>
                        	<div class="form-group">
							{{ form_label(form.timeGap) }}
							{{ form_widget(form.timeGap,{'attr':{ 'class': 'form-control'}}) }}

						</div>
                        <div class="form-group">
							{{ form_label(form.quarter) }}
							{{ form_widget(form.quarter,{'attr':{ 'class': 'form-control'}}) }}

						</div>


					</div>


				</div>
				<div class="modal-footer">
					<input class="btn btn-primary pull-right  " type="submit" value="{% trans %}Create{% endtrans %}"/>
					<button type="button" class="btn btn-default pull-left" data-dismiss="modal">Close</button>
					{{ form_end(form) }}
				</div>
			</div>
		</div>
		<div id="assign" class="modal fade" role="dialog">
			<div class="modal-dialog">
				<form
					method="post" action="{{path('task_assign')}}">

					<!-- Modal content-->
					<div class="modal-content">
						<div class="modal-header bg-info">
							<button type="button" class="close" data-dismiss="modal">&times;</button>
							<h4 class="modal-title">Assign Task</h4>
						</div>
						<div class="modal-body">

							<div class="row">
								<div class="col-md-6">

									<lable class=" control-label no-padding-right">
										<b>
											Select Performer
										</b>
									</lable>
									<select autocomplete="off" name="user[]" id="user" class="form-control user select2  " multiple="true">


										<option></option>
									</select>


								</div>
								<div class="col-md-6">

									<lable class=" control-label no-padding-right">
										<b>
											Select Task
										</b>
									</lable>
									<select autocomplete="off" name="task[]" id="crtask" class="form-control crtask select2  " multiple="true">


										<option></option>
									</select>


								</div>


							</div>
							<table class="table table-striped table-bordered table-hover" style="margin-top:10px;">
								<thead>
									<tr>
										<th>#</th>
										<th>Name</th>
										<th>ExpectedValue</th>

									</tr>
								</thead>
								<tbody>
									{% set count = 0 %}
									{% for measurement in measurements %}
										<tr>
											{% set count = count + 1 %}
											<td>{{ count}}</td>
											<td>{{ measurement.name }}</td>
											<input type="hidden" name="measurementId[]" value={{measurement.id}}>

											<td><input type="text" name="expectedValue[]" class="form-control"></td>


										</tr>
									{% else %}
										<tr>
											<td colspan="8">no records found</td>
										</tr>
									{% endfor %}
								</tbody>
							</table>


						</div>


					</div>
					<div class="modal-footer">
						<input class="btn btn-primary pull-right  " type="submit" value="{% trans %}Assign{% endtrans %}"/>
						<button type="button" class="btn btn-default pull-left" data-dismiss="modal">Close</button>
					</div>
				</form>
			</div>
		</div>
	{% endblock %}
	{% block javascripts %}
		<script src="{{asset('assets/plugins/bootstrap4-duallistbox/jquery.bootstrap-duallistbox.min.js')}}"></script>
		<script>
			$(function () {
$('.select2').css('width', '100%').select2({allowClear: true})
})
		</script>
		<script>
			$(document).ready(function () {

var select = $('.user')
var userprincipal = $('.office').val();
$.ajax({
url:"{{ path('user_fetch') }}",
method: "POST",
data: {
userprincipal: userprincipal
},
dataType: "json",
success: function (data) { // $('.department').children().remove()
for (let [key, value] of Object.entries(data)) {


select.append('<option value="' + value.id + '">' + value.fullName + ' </option>');


}
}
});
})
		</script>
		<script>
			$(document).ready(function () {
var task = $('.task').val();

var select = $('.crtask')

$.ajax({
url:"{{ path('task_fetch') }}",
method: "POST",
data: {
task: task
},
dataType: "json",
success: function (data) { // $('.department').children().remove()
for (let [key, value] of Object.entries(data)) {


select.append('<option value="' + value.id + '">' + value.taskName + ' </option>');


}
}
});
})
		</script>
		<script src="{{ asset('select2/js/select2.full.min.js')}}"></script>
		<script>
			$(function () { // Initialize Select2 Elements

$('.sel').click({theme: 'bootstrap4'});
// $('#fil').remove()
});
$('.sel').click(function () {
return !$('#user option:selected').remove().appendTo('.selectedPerformer');
})
$('.seltask').click(function () {
return !$('#crtask option:selected').remove().appendTo('.selectedtask');
})
$('.ret').click(function () {
return !$('.selectedPerformer option:selected').remove().appendTo('#user');
})
$('.rettask').click(function () {
return !$('.selectedtask option:selected').remove().appendTo('#crtask');
})
		</script>
        	<link rel="stylesheet" href="{{ asset('js/css/redmond.calendars.picker.css')}}">

	{# <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script> #}
	<script src="{{ asset('js/js/jquery.plugin.js') }}"></script>

	<script src="{{ asset('js/js/jquery.calendars.js') }}"></script>
	<script src="{{ asset('js/js/jquery.calendars.plus.js') }}"></script>
	<script src="{{ asset('js/js/jquery.calendars.picker.js') }}"></script>

	<script src="{{ asset('js/js/jquery.calendars.ethiopian.js') }}"></script>
	<script src="{{ asset('js/js/jquery.calendars.ethiopian-am.js') }}"></script>
	<script type="text/javascript" src="{{ asset('js/js/jquery.calendars.picker-am.js') }}"></script>
	<script>
		$(function () {
var calendar = $.calendars.instance('ethiopian', 'am');
console.log(calendar)
$('.popupDatepicker1').calendarsPicker({calendar: calendar});
$('.popupDatepicker').calendarsPicker({calendar: calendar});
});
	</script>
	{% endblock %}
