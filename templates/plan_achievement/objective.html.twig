{% extends 'base.html.twig' %}

{% block subTitle %}
	<li class="active">{% trans %}SMIS{% endtrans %}</li>
	<li class="active">
		<a href="{{path('plan_achievement_objective')}}">{% trans %}Objective Achievement{% endtrans %}</a>
	</li>
{% endblock %}
{% block stylesheet %}
	<style>
		.label {
			margin-left: 15px;
			font-family: 'Source Sans Pro', sans-serif;
			color: #666666;
			font-size: 14px;
		}
		.legendValue {
			float: left;
			height: 25px;
		}
		.clear {
			clear: both;
		}
	</style>
{% endblock %}

{% block body %}

	<div class="col-sm-12 col-md-12 col-lg-12">
		<div class="tabbable">
			<ul class="nav nav-tabs nav-justified  tab-color-blue" id="myTab">
				<li class="active">
					<a data-toggle="tab" href="#home" class="lead" aria-expanded="true">

						<strong>{% trans %}Tabular{% endtrans %}</strong>
					</a>
				</li>

				<li class="">
					<a data-toggle="tab" href="#messages" aria-expanded="false" class="lead">
						<strong>{% trans %}Visualization{% endtrans %}</strong>

					</a>
				</li>


			</ul>


			<div class="tab-content">
				<div id="home" class="tab-pane fade active in">
					<div class="row">
						<div class="col-sm-12 widget-container-col ui-sortable" id="widget-container-col-1">


							<div class="widget-body">
								<div class="widget-main">
									<div class="table-responsive">
										<span class="badge badge-info pull-right">
											{% trans %}Total{% endtrans %}
											:
											<strong>{{ plan_achievements.getTotalItemCount()}}</strong>
										</span>
										<table class="table table-striped table-bordered table-hover">
											<thead>
												<tr>

													<th rowspan="2">#</th>


													<th rowspan="2">Objective</th>
													<th rowspan="2">Goal</th>
													{# <th rowspan="2">{% trans %}behavior{% endtrans %}</th> #}

													<th rowspan="2">Year</th>
													<th colspan="2">yearly</th>
													<th colspan="2">1st Quarter</th>
													<th colspan="2">2nd Quarter</th>
													<th colspan="2">3rd Quarter</th>
													<th colspan="2">4th  Quarter</th>


												</tr>

												<tr>


													<th>plan</th>
													<th>Accomp.</th>
													<th>plan</th>
													<th>Accomp.</th>
													<th>plan</th>
													<th>Accomp.</th>
													<th>plan</th>
													<th>Accomp.</th>
													<th>plan</th>
													<th>Accomp.</th>


												</tr>
											</thead>
											<tbody>
												{% set count =  plan_achievements.getItemNumberPerPage() * (plan_achievements.getCurrentPageNumber() -1) %}
												{% for plan_achievement in plan_achievements %}

													{% set count = count+1 %}
													<tr>
														<td>{{count}}
														</td>


														<td>{{plan_achievement.objective}}</td>
														<td>{{plan_achievement.objective.goal}}</td>
														{# <td>{{plan_achievement.initiative.initiativeBehaviour}}</td> #}

														<td>{{plan_achievement.year}}</td>
														<td></td>
														<td></td>
														{% for quarterplan in plan_achievement.quarterAchievement %}
															<td>{{quarterplan.plan }}</td>
															<td>{{quarterplan.accomp?quarterplan.accomp:"_" }}</td>
														{% endfor %}


													</tr>


												{% endfor %}


											</tbody>
										</table>
										<div class="pull-right" style="" id="custompaginator">{{ knp_pagination_render(plan_achievements) }}</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div id="messages">
					<canvas id="myChart" width="400" height="400"></canvas>
					{# <div id="legend"></div> #}
				</div>
			</div>


		</div>


	</div>
{% endblock %}
{% block javascripts %}
	<script src="{{asset('assets/assets/js/jquery-ui.custom.min.js')}}"></script>
	<script src="{{asset('chart.js-3.3.2/package/dist/chart.min.js')}}"></script>
	<script>
		$(function () {
$('#reloadbtn').click(function () {
$('#reload').trigger('click');
// $('#reloadform').submit();
})
function getRandomColor() {
var letters = '0123456789ABCDEF';
var color = '#';
for (var i = 0; i < 6; i++) {
color += letters[Math.floor(Math.random() * 16)];
}
return color;
}
var bgcolor = [];
var fillColor = [];{% for objective in data.objective %}bgcolor.push(getRandomColor());
fillColor.push(getRandomColor());{% endfor %}var ctx = document.getElementById("myChart").getContext('2d');


var dat = {
labels: [{{ data.year|join(',') }}],
datasets: [{% for objective in data.objective %}{

label: "{{ objective.name }}",
fillColor: fillColor[{{ loop.index }}],
strokeColor: fillColor[{{ loop.index }}],
highlightFill: fillColor[{{ loop.index }}],
highlightStroke: fillColor[{{ loop.index }}],
data: [{{ objective.achieve|join(',') }}],
backgroundColor: [{% for i in range(1,objective.achieve|length) %}bgcolor[{{ loop.parent.loop.index }}],{% endfor %}],
borderColor: [{% for i in range(1,objective.achieve|length) %}fillColor[{{ loop.parent.loop.index }}],{% endfor %}],
borderWidth: 1
}
{% if loop.last != true %},{% endif %}{% endfor %}]
};


var myChart = new Chart(ctx, {
type: 'bar',
barShowStroke: false,
data: dat,
options: {
responsive: true, // Instruct chart js to respond nicely.
maintainAspectRatio: false, // Add to prevent default behaviour of full-width/height
legend: {
display: false,
position: 'top'

},
plugins: {

title: {
display: true,
text: 'jimma University Objective Accomplishment'
}
},
legendCallback: function (chart) {
var text = [];
text.push('<ul class=">' + chart.id + '-legend">');
for (var i = 0; i < chart.data.datasets.length; i++) {
text.push('<li><div class="legendValue"><span style="background-color:' + chart.data.datasets[i].backgroundColor + '">&nbsp;&nbsp;&nbsp;&nbsp;</span>');
if (chart.data.datasets[i].label) {
text.push('<span class="label">' + chart.data, datasets[i].label + '</span>');

}
text.push('</div></li><div class="clear"></div>');
}
text.push('</ul>');
return text.join('');
},
scales: {
yAxes: [
{
display: true,
tricks: {
beginAtZero: true
},
gridlines: {
color: "rgba(0,0,0,0)"
}

}
],
xAxes: [
{
display: false,
gridlines: {
color: "rgba(0,0,0,0)"
},
barPercentage: 0.5,
categoryPercentage: 0.5
}
]
},
scaleFontSize: 16,
showTooltips: false,
scaleGridLineColor: "rgba(0,0,0,.05)",
scaleGridLineWidth: 1


}
});
$('#legend').prepend(myChart.generatelegend());
})
	</script>
{% endblock %}
